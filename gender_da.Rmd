---
title: "Gender Equality DA"
author: "Sarah Shy"
date: "2/22/2020"
output: html_document
---

# Front matter
```{r}
# clear environment
rm(list = ls())

# load libraries
library(tidyverse)
```

```{r, message = F, warning = F}
# load data

enroll <- read.csv("Data/enrollment.csv")
math.pisa <- read.csv("Data/oecd_pisa_math.csv")
sci.pisa <- read.csv("Data/oecd_pisa_science.csv")
grads <- read.csv("Data/2017_grads_field.csv")
earn.deg <- read.csv("Data/earnings_degree.csv")
earn.numeracy <- read.csv("Data/earnings_numeracylevel.csv")
```

For more data, see <https://stats.oecd.org/>

The data:
- Enrollment in STEM grad programs, broken down by gender, field, level of education
- PISA science scores  
- PISA math scores  
- Graduation broken down by degree, field, gender (2017)  
- Earnings broken down by degree, gender, age (values are percentages, 100 refers to the average earnings of all people who completed secondary school)  
- Earnings broken down by numeracy level, gender (all ages 25-64, data from 2012 and 2015)

Enrollment data comes from <https://stats.oecd.org/> table called "Enrolment by field"

Dataset documentation can be found [here (math)](https://data.oecd.org/pisa/mathematics-performance-pisa.htm)
and [here (science)](https://data.oecd.org/pisa/science-performance-pisa.htm#indicator-chart)

Share of graduates by field data comes from [here](https://stats.oecd.org/viewhtml.aspx?datasetcode=EAG_GRAD_ENTR_FIELD&lang=en#)

Earnings by numeracy level found [here](https://stats.oecd.org/viewhtml.aspx?datasetcode=EAG_EA_SKILLS&lang=en#)


# Enrollment in grad programs

### Clean data
```{r}
# Clean data

# create reference table for flags
# I don't really know what these mean
tbl.flags <- as.data.frame(unique(enroll$Flag.Codes)) %>% bind_cols(as.data.frame(unique(enroll$Flags)))


# SEX and Sex columns are identical, remove Sex
# remove other redundant, useless variables
enroll.clean <- enroll %>% select(-c(Sex, COUNTRY, FIELD, COUNTRY_ORIGIN, Country.of.origin, ISC11_LEVEL, ISC11P_CAT, Category.of.education, YEAR, Unit.Code, Unit, PowerCode.Code, PowerCode, Reference.Period.Code, Reference.Period))
```

### EDA

- Each case represents enrollment in each country at a specific year, STEM field, and program level.

```{r}
enroll.clean$Country %>% nlevels
enroll.clean$Year %>% table
enroll.clean$Level.of.education %>% levels
```

- We have 40 countries observed over 5 years
- 3 levels of education plus total (Bachelor, Master, Doctoral, and Total Grad)

### Some analysis

#### Most recent 2017 data
```{r}
enroll17 <-
  enroll.clean %>%
  filter(Year == 2017)

enroll.by.gender <-
  enroll17 %>%
  group_by(Country, SEX) %>%
  summarise(enrollment = sum(Value)) %>%
  pivot_wider(names_from = SEX, values_from = enrollment, names_prefix = "enroll_") %>%
  mutate(enroll_Total = sum(enroll_F, enroll_M), prop_F = enroll_F/sum(enroll_F, enroll_M))
# Costa Rica, Germany, Mexico, Russia have NA's
```

```{r}
# plot proportion of females enrolling in STEM grad programs in 2017
ggplot(enroll.by.gender, aes(y = prop_F)) + geom_boxplot() + theme_bw() + ggtitle("Proportion of females enrolling in STEM grad programs")
```

```{r}
# change over year, across all countries?
```


