---
title: "Gender Equality DA"
author: "Sarah Shy"
date: "2/22/2020"
output: html_document
---

# Front matter
```{r, message = F, warning = F}
# clear environment
rm(list = ls())

# load libraries
library(tidyverse)
library(maps)
```

```{r, message = F, warning = F}
# load data

enroll <- read.csv("Data/CLEAN_enrollment.csv")
math.pisa <- read.csv("Data/CLEAN_pisa_math.csv")
sci.pisa <- read.csv("Data/CLEAN_pisa_science.csv")
grads <- read.csv("Data/CLEAN_2017_grads_field.csv")
earn.deg1 <- read.csv("Data/CLEAN_earnings_degree.csv")
earn.numeracy <- read.csv("Data/CLEAN_earnings_numeracy.csv")
```

For more data, see <https://stats.oecd.org/>

The data:
- Enrollment in STEM grad programs, broken down by gender, field, level of education
- PISA science scores  
- PISA math scores  
- Graduation broken down by degree, field, gender (2017)  
- Earnings broken down by degree, gender, age (values are percentages, 100 refers to the average earnings of all people who completed secondary school)  
- Earnings broken down by numeracy level, gender (all ages 25-64, data from 2012 and 2015)

Enrollment data comes from <https://stats.oecd.org/> table called "Enrolment by field"

Dataset documentation can be found [here (math)](https://data.oecd.org/pisa/mathematics-performance-pisa.htm)
and [here (science)](https://data.oecd.org/pisa/science-performance-pisa.htm#indicator-chart)

Share of graduates by field data comes from [here](https://stats.oecd.org/viewhtml.aspx?datasetcode=EAG_GRAD_ENTR_FIELD&lang=en#)

Earnings by numeracy level found [here](https://stats.oecd.org/viewhtml.aspx?datasetcode=EAG_EA_SKILLS&lang=en#)


# Enrollment in grad programs

- Each case represents enrollment in each country at a specific year, STEM field, and program level.

```{r}
names(enroll)
enroll$country %>% nlevels
enroll$year %>% table
enroll$level.of.education %>% levels

levels(enroll$level.of.education) <- c("Bachelor's or equivalent", "Master's or equivalent", "Doctoral of equivalent", "Total")
```

- We have 40 countries observed over 5 years
- 3 levels of education plus total (Bachelor, Master, Doctoral, and Total Grad)

```{r}
# enrollment by program level and gender

prop <-
  enroll %>%
  group_by(level.of.education, sex) %>%
  summarise(count = sum(n.people, na.rm = T)) %>%
  filter(level.of.education != "Total")

ggplot(prop, aes(x = level.of.education, y = count, fill = sex)) +
  geom_bar(stat = "identity", position = "fill") +
  ggtitle("Enrollment by Level and Sex, 2013-2017") +
  xlab("Program level") +
  ylab("Proportion") +
  theme_bw()
```

- There are more males than females enrolling in every degree level (STEM fields only)

```{r}
# enrollment of females in grad programs across years
enroll.by.year <-
  enroll %>%
  group_by(year, sex) %>%
  summarise(count = sum(n.people, na.rm = T))

ggplot(enroll.by.year) +
  geom_bar(aes(x = year, y = count, fill = sex), stat = "identity", position = "fill")

enroll.by.country <- enroll %>% group_by(country, sex) %>% summarise(count = sum(n.people, na.rm = T)) %>%
  pivot_wider(values_from = count, names_from = sex, names_prefix = "count_") %>%
  mutate(prop_F = count_F/sum(count_F, count_M))

# recode USA and UK
enroll.by.country$country <- enroll.by.country$country %>% recode("United States" = "USA", "United Kingdom" = "UK")
```

- Enrollment has not changed between 2013 and 2017

```{r}
# prop of women enrollment by country
library(rworldmap)
map.world <- map_data(map="world")
world.join <- left_join(map.world, enroll.by.country, by = c("region" = "country"))
ggplot() +
  geom_map(data = world.join, map = world.join, aes(map_id = region, x = long, y = lat, fill = prop_F)) +
  scale_fill_gradient(low = "red", high = "green", guide = "colourbar") +
  coord_equal() +
  ggtitle("Proportion of Female enrollment in grad programs, 2013-2017")
```

```{r}
enroll.by.country %>% arrange(desc(prop_F))
```


# Graduation from grad progams

```{r}
names(grads)
```


### (Old code chunks) Enrollment in Graduate Programs
```{r}
enroll17 <-
  enroll %>%
  filter(year == 2017)

enroll.by.gender <-
  enroll17 %>%
  group_by(country, sex) %>%
  summarise(enrollment = sum(n.people)) %>%
  pivot_wider(names_from = sex, values_from = enrollment, names_prefix = "enroll_") %>%
  mutate(enroll_Total = sum(enroll_F, enroll_M), prop_F = enroll_F/sum(enroll_F, enroll_M))
# Costa Rica, Germany, Mexico, Russia have NA's
```

```{r}
# plot proportion of females enrolling in STEM grad programs in 2017
ggplot(enroll.by.gender, aes(y = prop_F)) + geom_boxplot() + theme_bw() + ggtitle("Proportion of females enrolling in STEM grad programs")
```

```{r}
# change over year, across all countries?
```

```{r}
#mmath pisa

math.pisa %>% group_by(subject) %>% summarise(meanScore = mean(mean.score), count = n())
```

